
```{r criando funções}
# Função para converter todas as colunas para o tipo character
convert_to_character <- function(df) {
  df[] <- lapply(df, as.character)
  return(df)
}

###########################################################################

# Função para normalizar os nomes das colunas
library(stringr)
normalize_column_names <- function(df) {
  # Remover acentuação
  colnames(df) <- iconv(colnames(df), from = "UTF-8", to = "ASCII//TRANSLIT")
  # Converter para minúsculas
  colnames(df) <- tolower(colnames(df))
  # Substituir espaços por underscores
  colnames(df) <- str_replace_all(colnames(df), " ", "_")
  # Remover caracteres especiais, mantendo apenas letras, números e underscores
  colnames(df) <- gsub("[^a-z0-9_]", "", colnames(df))
  # Substituir múltiplos underscores consecutivos por um único underscore
  colnames(df) <- gsub("_+", "_", colnames(df))
  # Remover underscores no início ou fim dos nomes de colunas
  colnames(df) <- gsub("^_|_$", "", colnames(df))
  
  return(df)
}

normalize_vector_names <- function(v) {
  # Remover acentuação
  v <- iconv(v, from = "UTF-8", to = "ASCII//TRANSLIT")
  # Converter para minúsculas
  v <- tolower(v)
  # Substituir espaços por underscores
  v <- str_replace_all(v, " ", "_")
  # Remover caracteres especiais, mantendo apenas letras, números e underscores
  v <- gsub("[^a-z0-9_]", "", v)
  # Substituir múltiplos underscores consecutivos por um único underscore
  v <- gsub("_+", "_", v)
  # Remover underscores no início ou fim dos nomes
  v <- gsub("^_|_$", "", v)
  
  return(v)
}
```

```{r}
df = read_excel('DADOS_SIMULADOS.xlsx')
df = normalize_column_names(df)
# df %>% View()

df = df %>% filter(!moeda %in% c('XRP','PEPE','DOGE'))
df$estrategia = factor(df$estrategia, levels = c('UT BOTS','MA RSI e VOLUME','MA ANTECIPATION','MA SIMPLES FALLBACK','RSI','VORTEX'))
df$candle_period = factor(df$candle_period, levels = c('1m', '3m', '5m', '15m', '30m', '1h', '2h', '4h', '6h', '8h', '12h', '1d', '1w'))
df$tempo_rodando = factor(df$tempo_rodando, levels = c('dia', 'semana', 'mes'))

df = df %>% arrange(-lucroprejuizo_percentual) %>% filter(tempo_rodando != 'mes' & candle_period != '1w')
```

```{r}
df$lucroprejuizo_percentual %>% summary()
df$faixa_lucroprejuizo <- cut(df$lucroprejuizo_percentual, 
                              breaks = seq(-35, 25, by = 5), 
                              include.lowest = TRUE, 
                              right = FALSE)

# Criando os rótulos numerados para manter a ordenação
levels(df$faixa_lucroprejuizo) <- paste0(sprintf("%02d ", seq_along(levels(df$faixa_lucroprejuizo))), 
                                         levels(df$faixa_lucroprejuizo))

# Verificando a contagem de cada faixa
table(df$faixa_lucroprejuizo, df$moeda)

```
```{r}
library(ggplot2)
library(dplyr)

# Criando a tabela de contagem
contagem <- as.data.frame(table(df$faixa_lucroprejuizo, df$moeda))
colnames(contagem) <- c("faixa_lucroprejuizo", "moeda", "quantidade")

# Criando o gráfico de barras empilhadas
ggplot(contagem, aes(x = moeda, y = quantidade, fill = faixa_lucroprejuizo)) +
  geom_bar(stat = "identity") +
  labs(title = "Distribuição das Faixas de Lucro/Prejuízo por Moeda",
       x = "Moeda",
       y = "Quantidade",
       fill = "Faixa de Lucro/Prejuízo") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

```{r}
for (coluna in names(df)){
  print(paste('*************', coluna, '*************'))
  classe = df[[coluna]] %>% class()
  
  if (classe == 'factor' | classe == 'character'){
    cont(df, coluna) %>% as.matrix() %>% print()
  } else {
    df[[coluna]] %>% summary() %>% print()
  }
}
```

```{r}
df %>% View()
df %>% arrange(-lucroprejuizo_percentual) %>% filter(tempo_rodando == 'dia') %>% View()
```


```{r}
df %>% filter(df$candle_period == '1w' & df$tempo_rodando == 'semana')
```


```{r}
# library(ggplot2)
# library(plotly)
# library(dplyr)
nome_moeda = 'BNB'
df_filter = df %>% filter(moeda == nome_moeda, candle_period != '1w')
ggplot(df_filter, aes(x = lucroprejuizo_percentual, y = estrategia, fill=lucroprejuizo_percentual)) +
  facet_grid(tempo_rodando~candle_period) +
  geom_point(shape=21, size=3, alpha=0.5) +
  # Adicionando as linhas verticais
  geom_vline(xintercept = 0, color = "red", linetype = "dashed", size = 0.5) +
  labs(title = nome_moeda)


# Convertendo para um gráfico interativo com plotly
# ggplotly(p)

```


```{r}
df_filter = df 
ggplot(df_filter, aes(x = lucroprejuizo_percentual, y = estrategia, color=estrategia)) +
  facet_grid(tempo_rodando~candle_period) +
  geom_boxplot(alpha=0.8, show.legend=F, width=0.5) +
  geom_vline(xintercept = 0, color = "red", linetype = "dashed", size = 0.5) + 
  theme_bw()

ggsave("nome_grafico.png", height=20, width=45, units="cm", dpi= 600)
```


```{r}

```


```{r}
```


```{r}
```


```{r}
```


```{r}
```


```{r}
```


```{r}
```


```{r}
```


```{r}
```


```{r}
```


```{r}
```


```{r}
```


```{r}
```


```{r}
```


```{r}
```


```{r}
```


```{r}
```


```{r}
```


```{r}
```


```{r}
```

